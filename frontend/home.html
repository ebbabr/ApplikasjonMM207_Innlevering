<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login or create user</title>
    
  </head>
  <body style="background-color:lightgrey;"></body>

  <button id = 'backwards' class="buttonClass">Back</button>

    <header class="center">
      <h1>Create user or Log in</h1>
      <br />

      <div container id="placeHere" class="placeHere">
        <input id="inputName" type="text" placeholder="Username" />
        <input id="inputPassword" type="text" placeholder="Password" />
        <button id="btnShow" class="buttonClass">Show password</button>
        <br />

        <button id="btnLogin" class="buttonClass">Log in</button>
        <button id="btnCreateUser" class="buttonClass">Create user</button>
        <h3 id="txtResult"></h3>
      </div>
    </header>

  

    <script>
        let inputName = document.getElementById("inputName");
        let inputPassword = document.getElementById("inputPassword");
        let btnLogin = document.getElementById("btnLogin");
        let btnShow = document.getElementById("btnShow");
        let txtResult = document.getElementById("txtResult");
        let btnCreateUser = document.getElementById('btnCreateUser')
        let backwardsBtn = document.getElementById('backwards');
        
        backwardsBtn.addEventListener('click', function(evt){
            location.href = 'index.html';
        })


        window.onload = function () {
            let string = document.getElementById("inputPassword");
            if (string.type === "password") {
            string.type = "text";
            } else {
            string.type = "password";
            }
        };

        btnShow.addEventListener("click", function () {
            let string = document.getElementById("inputPassword");
            if (string.type === "text") {
            string.type = "password";
            } else {
                string.type = "text";
            }
        });



        btnLogin.addEventListener("click", async function (evt) {
            let url = "login.html";
            let credString = createCredentialString(
                inputName.value,
                inputPassword.value
            );

            let cfg = {
                method: "POST",
            };

            try {
                let response = await fetch(url, cfg);
                let data = await response.json();

                if (response.status != 200) {
                    throw data.error;
                }

                window.location.href = "users.html"


            } catch (error) {
                txtResult.innerHTML = error;
            }
        });


        btnCreateUser.addEventListener("click", async function (evt) {
            

            let username = inputName.value;
            let password = inputPassword.value;

            let url = "users.html";
        


            try {
                let response = await fetch(url, cfg);
                let data = await response.json();

                if (response.status != 200) {
                    throw data.error;
                }

                txtResult.innerHTML = data.msg;

            } catch (error) {
                txtResult.innerHTML = error;
                }
            });


    </script>
  </body>
</html>
